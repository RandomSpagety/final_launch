<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Doctor Dashboard</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
<header class="nav"><div class="nav-inner">
  <a class="brand" href="/index.html"><span class="brand-dot"></span> Doctor</a>
  <nav><a href="/index.html">Home</a></nav>
</div></header>

<main class="container">
  <div class="card">
    <h3>My Appointments</h3>
    <table class="table" id="apps">
      <thead><tr><th>Date</th><th>Time</th><th>Patient</th><th>Reason</th><th></th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<script>
  const token = localStorage.getItem('demoToken');
  if(!token || localStorage.getItem('role')!=='doctor'){
    alert('Doctor only.'); location.href='/login.html';
  }

  async function load(){
    const res = await fetch('/api/doctor/appointments', { headers:{Authorization:`Bearer ${token}`}});
    const rows = await res.json();
    const tbody = document.querySelector('#apps tbody');
    tbody.innerHTML='';
    rows.forEach(a=>{
      const tr = document.createElement('tr');
      const date = new Date(a.date).toLocaleDateString();
      tr.innerHTML = `
        <td>${date}</td>
        <td>${a.time}</td>
        <td>${(a.createdBy?.name)||a.patientName}</td>
        <td>${a.reason||''}</td>
        <td><button class="btn danger" onclick="delApp('${a._id}')">Delete</button></td>`;
      tbody.appendChild(tr);
    });
  }

  async function delApp(id){
    if(!confirm('Delete this appointment?')) return;
    const res = await fetch('/api/doctor/appointments/'+id, {
      method:'DELETE',
      headers:{Authorization:`Bearer ${token}`}
    });
    if(res.ok) load(); else alert('Delete failed');
  }
  load();
</script>
<script src="/script/auth-ui.js"></script>

</body>
</html>
